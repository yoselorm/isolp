<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="ISOLP" />
    <meta name="description" content="Fistula Tract Cancer Survey | ISoLP Research">
    <link rel="icon" type="image/png" href="images/isolpicon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Fistula Tract Cancer Survey | ISoLP</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            padding: 20px 0;
        }
        
        .survey-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .survey-header {
            background: linear-gradient(135deg, #0066cc, #004499);
            padding: 30px 20px;
            color: white;
            text-align: center;
            margin-bottom: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .survey-header h1 {
            font-size: 30px;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .survey-section {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            border: 1px solid #e8e8e8;
            backdrop-filter: blur(10px);
        }
        
        .section-title {
            color: #2c3e50;
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 25px;
            border-bottom: 3px solid #0066cc;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .form-section-number {
            background: linear-gradient(135deg, #0066cc, #004499);
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            font-size: 18px;
            box-shadow: 0 4px 15px rgba(0, 102, 204, 0.3);
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 16px;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e8e8e8;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .form-control:focus {
            outline: none;
            border-color: #0066cc;
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
            transform: translateY(-1px);
        }
        
        .radio-group, .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .radio-item, .checkbox-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border: 2px solid #e8e8e8;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.5);
            position: relative;
            overflow: hidden;
        }
        
        .radio-item::before, .checkbox-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 102, 204, 0.1), transparent);
            transition: left 0.5s;
        }
        
        .radio-item:hover::before, .checkbox-item:hover::before {
            left: 100%;
        }
        
        .radio-item:hover, .checkbox-item:hover {
            border-color: #0066cc;
            background: rgba(0, 102, 204, 0.05);
            transform: translateX(5px);
        }
        
        .radio-item input[type="radio"], .checkbox-item input[type="checkbox"] {
            margin-right: 12px;
            transform: scale(1.3);
            cursor: pointer;
        }
        
        .radio-item.selected, .checkbox-item.selected {
            border-color: #0066cc;
            background: linear-gradient(135deg, rgba(0, 102, 204, 0.1), rgba(0, 68, 153, 0.1));
            color: #0066cc;
            font-weight: 600;
            transform: translateX(5px);
        }
        
        .other-input {
            width: 100%;
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            display: none;
            transition: all 0.3s ease;
        }
        
        .other-input.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .textarea-large {
            min-height: 120px;
            resize: vertical;
        }
        
        .btn-submit {
            background: linear-gradient(135deg, #0066cc, #004499);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 30px;
            box-shadow: 0 8px 25px rgba(0, 102, 204, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .btn-submit::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-submit:hover::before {
            left: 100%;
        }
        
        .btn-submit:hover {
            background: linear-gradient(135deg, #0052a3, #003366);
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(0, 102, 204, 0.4);
        }
        
        .btn-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .progress-bar {
            background: rgba(255, 255, 255, 0.3);
            height: 8px;
            border-radius: 4px;
            margin-bottom: 30px;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .progress-fill {
            background: linear-gradient(135deg, #0066cc, #004499);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(0, 102, 204, 0.5);
        }
        
        .required {
            color: #dc3545;
            font-weight: bold;
        }
        
        .success-message {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-top: 20px;
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .error-message {
            background: linear-gradient(135deg, #dc3545, #e74c3c);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-top: 20px;
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin-right: 10px;
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .survey-container {
                padding: 0 15px;
            }
            
            .survey-section {
                padding: 25px 20px;
            }
            
            .survey-header {
                padding: 40px 20px;
            }
            
            .survey-header h1 {
                font-size: 28px;
            }
            
            .section-title {
                font-size: 24px;
            }
            
            .form-section-number {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
        }
    </style>
</head>

<body>
    <div class="survey-container">
        
        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <!-- Survey Header -->
        <div class="survey-header">
            <h1>Fistula Tract Cancer Survey</h1>
        </div>

        <form id="fistulaTrackSurvey">
            <!-- Section 1: Demographics -->
            <div class="survey-section">
                <h2 class="section-title">
                    <span class="form-section-number">1</span>
                    Demographics
                </h2>

                <div class="form-group">
                    <label class="form-label">1.1. Age group <span class="required">*</span></label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="age_group" value="Under 30" id="age_under_30" required>
                            <label for="age_under_30">Under 30</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="age_group" value="30-39" id="age_30_39">
                            <label for="age_30_39">30-39</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="age_group" value="40-49" id="age_40_49">
                            <label for="age_40_49">40-49</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="age_group" value="50-59" id="age_50_59">
                            <label for="age_50_59">50-59</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="age_group" value="60 or above" id="age_60_above">
                            <label for="age_60_above">60 or above</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">1.2. Sex <span class="required">*</span></label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="sex" value="Male" id="sex_male" required>
                            <label for="sex_male">Male</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="sex" value="Female" id="sex_female">
                            <label for="sex_female">Female</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="sex" value="Prefer not to say" id="sex_prefer_not">
                            <label for="sex_prefer_not">Prefer not to say</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">1.3. Years of experience in colorectal surgery/coloproctology <span class="required">*</span></label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="years_experience" value="Less than 5 years" id="exp_less_5" required>
                            <label for="exp_less_5">Less than 5 years</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="years_experience" value="5-10 years" id="exp_5_10">
                            <label for="exp_5_10">5-10 years</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="years_experience" value="More than 10 years" id="exp_more_10">
                            <label for="exp_more_10">More than 10 years</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">1.4. Geographic location or region (Country) <span class="required">*</span></label>
                    <select class="form-control" name="country" id="country" required>
                        <option value="">Select a country</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">1.5. Practice setting <span class="required">*</span></label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="practice_setting" value="Academic" id="practice_academic" required>
                            <label for="practice_academic">Academic</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="practice_setting" value="Private practice" id="practice_private">
                            <label for="practice_private">Private practice</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="practice_setting" value="Hospital-based" id="practice_hospital">
                            <label for="practice_hospital">Hospital-based</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="practice_setting" value="Tertiary Hospital" id="practice_tertiary">
                            <label for="practice_tertiary">Tertiary Hospital</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="practice_setting" value="Specialized Medical Center" id="practice_specialized">
                            <label for="practice_specialized">Specialized Medical Center</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="practice_setting" value="Other" id="practice_other">
                            <label for="practice_other">Other (please specify)</label>
                        </div>
                    </div>
                    <input type="text" class="other-input" id="practice_other_text" placeholder="Please specify...">
                </div>

                <div class="form-group">
                    <label class="form-label">1.6. Specialization <span class="required">*</span></label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="specialization" value="General Surgeon" id="spec_general" required>
                            <label for="spec_general">General Surgeon</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="specialization" value="Gastroenterologist" id="spec_gastro">
                            <label for="spec_gastro">Gastroenterologist</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="specialization" value="Proctologist" id="spec_procto">
                            <label for="spec_procto">Proctologist</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="specialization" value="Dermatologist" id="spec_derm">
                            <label for="spec_derm">Dermatologist</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="specialization" value="Colorectal Surgeon" id="spec_colorectal">
                            <label for="spec_colorectal">Colorectal Surgeon</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="specialization" value="Other" id="spec_other">
                            <label for="spec_other">Other (please specify)</label>
                        </div>
                    </div>
                    <input type="text" class="other-input" id="spec_other_text" placeholder="Please specify...">
                </div>

                <div class="form-group">
                    <label class="form-label">1.7. Number of fistula cases managed per year <span class="required">*</span></label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="fistula_cases" value="Less than 10" id="cases_less_10" required>
                            <label for="cases_less_10">Less than 10</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="fistula_cases" value="10-20" id="cases_10_20">
                            <label for="cases_10_20">10-20</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="fistula_cases" value="21-50" id="cases_21_50">
                            <label for="cases_21_50">21-50</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="fistula_cases" value="More than 50" id="cases_more_50">
                            <label for="cases_more_50">More than 50</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">1.8. Procedures used to manage fistulas (select all that apply) <span class="required">*</span></label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" name="procedures" value="Seton placement" id="proc_seton">
                            <label for="proc_seton">Seton placement</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="procedures" value="Fistulotomy/Fistulectomy" id="proc_fistulotomy">
                            <label for="proc_fistulotomy">Fistulotomy/Fistulectomy</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="procedures" value="Ligation of Intersphincteric Fistula Tract (LIFT)" id="proc_lift">
                            <label for="proc_lift">Ligation of Intersphincteric Fistula Tract (LIFT)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="procedures" value="Fistula plugs" id="proc_plugs">
                            <label for="proc_plugs">Fistula plugs</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="procedures" value="FiLaC (Fistula Laser Closure)" id="proc_filac">
                            <label for="proc_filac">FiLaC (Fistula Laser Closure)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="procedures" value="VAAFT (Video-Assisted Anal Fistula Treatment)" id="proc_vaaft">
                            <label for="proc_vaaft">VAAFT (Video-Assisted Anal Fistula Treatment)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="procedures" value="Flaps" id="proc_flaps">
                            <label for="proc_flaps">Flaps</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="procedures" value="Other" id="proc_other">
                            <label for="proc_other">Other (please specify)</label>
                        </div>
                    </div>
                    <input type="text" class="other-input" id="proc_other_text" placeholder="Please specify...">
                </div>

                <div class="form-group">
                    <label class="form-label">1.9. Are you currently a member of the International Society of Laser Proctology (ISoLP)? <span class="required">*</span></label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="is_islop_member" value="Yes" id="member_yes" required>
                            <label for="member_yes">Yes</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="is_islop_member" value="No" id="member_no">
                            <label for="member_no">No</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 2: Knowledge & Awareness -->
            <div class="survey-section">
                <h2 class="section-title">
                    <span class="form-section-number">2</span>
                    Knowledge & Awareness
                </h2>

                <div class="form-group">
                    <label class="form-label">2.1. How familiar are you with fistula tract cancer? <span class="required">*</span></label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="familiarity" value="Very familiar" id="fam_very" required>
                            <label for="fam_very">Very familiar</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="familiarity" value="Somewhat familiar" id="fam_somewhat">
                            <label for="fam_somewhat">Somewhat familiar</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="familiarity" value="Heard of it" id="fam_heard">
                            <label for="fam_heard">Heard of it</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="familiarity" value="Not familiar" id="fam_not">
                            <label for="fam_not">Not familiar</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">2.2. Have you encountered cases of fistula tract cancer in your practice? <span class="required">*</span></label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="encountered_cases" value="Yes" id="encountered_yes" required>
                            <label for="encountered_yes">Yes</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="encountered_cases" value="No" id="encountered_no">
                            <label for="encountered_no">No</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">2.3. In your opinion, how common is fistula tract cancer among patients with chronic anal fistula? <span class="required">*</span></label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="opinion_commonality" value="Rare" id="common_rare" required>
                            <label for="common_rare">Rare</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="opinion_commonality" value="Uncommon" id="common_uncommon">
                            <label for="common_uncommon">Uncommon</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="opinion_commonality" value="Fairly common" id="common_fairly">
                            <label for="common_fairly">Fairly common</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="opinion_commonality" value="Typical" id="common_typical">
                            <label for="common_typical">Typical</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 3: Diagnostic Practices -->
            <div class="survey-section">
                <h2 class="section-title">
                    <span class="form-section-number">3</span>
                    Diagnostic Practices
                </h2>

                <div class="form-group">
                    <label class="form-label">3.1. What diagnostic modalities do you use or consider when evaluating complex fistulas? (Select all that apply) <span class="required">*</span></label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" name="diagnostics_used" value="MRI" id="diag_mri">
                            <label for="diag_mri">MRI</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="diagnostics_used" value="Endoanal ultrasound" id="diag_ultrasound">
                            <label for="diag_ultrasound">Endoanal ultrasound</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="diagnostics_used" value="Clinical examination" id="diag_clinical">
                            <label for="diag_clinical">Clinical examination</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="diagnostics_used" value="Biopsy" id="diag_biopsy">
                            <label for="diag_biopsy">Biopsy</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="diagnostics_used" value="Other" id="diag_other">
                            <label for="diag_other">Other (please specify)</label>
                        </div>
                    </div>
                    <input type="text" class="other-input" id="diag_other_text" placeholder="Please specify...">
                </div>

                <div class="form-group">
                    <label class="form-label">3.2. How confident are you in diagnosing fistula tract cancer preoperatively? <span class="required">*</span></label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="confidence_in_diagnosis" value="Very confident" id="conf_very" required>
                            <label for="conf_very">Very confident</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="confidence_in_diagnosis" value="Somewhat confident" id="conf_somewhat">
                            <label for="conf_somewhat">Somewhat confident</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="confidence_in_diagnosis" value="Not confident" id="conf_not">
                            <label for="conf_not">Not confident</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">3.3. Based on your clinical experience and available literature, would you routinely perform histopathological examination of the fistula tract? <span class="required">*</span></label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="routine_histopathology" value="Yes" id="hist_yes" required>
                            <label for="hist_yes">Yes</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="routine_histopathology" value="No" id="hist_no">
                            <label for="hist_no">No</label>
                        </div>
                    </div>
                </div>

                <div class="form-group" id="hist_yes_group" style="display: none;">
                    <label class="form-label">3.4. Why do you routinely perform histopathology? (Select all that apply)</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" name="histopathology_yes_reason" value="To rule out malignancy" id="hist_yes_malignancy">
                            <label for="hist_yes_malignancy">To rule out malignancy</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="histopathology_yes_reason" value="As a standard part of operative protocol" id="hist_yes_protocol">
                            <label for="hist_yes_protocol">As a standard part of operative protocol</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="histopathology_yes_reason" value="Due to suspicion during surgery or clinical examination" id="hist_yes_suspicion">
                            <label for="hist_yes_suspicion">Due to suspicion during surgery or clinical examination</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="histopathology_yes_reason" value="Other" id="hist_yes_other">
                            <label for="hist_yes_other">Other (please specify)</label>
                        </div>
                    </div>
                    <input type="text" class="other-input" id="hist_yes_other_text" placeholder="Please specify...">
                </div>

                <div class="form-group" id="hist_no_group" style="display: none;">
                    <label class="form-label">3.5. Under what circumstances would you consider performing histopathology? (Select all that apply)</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" name="histopathology_no_reason" value="When clinical suspicion of malignancy exists" id="hist_no_suspicion">
                            <label for="hist_no_suspicion">When clinical suspicion of malignancy exists</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="histopathology_no_reason" value="If the fistula appears atypical or suspicious during surgery" id="hist_no_atypical">
                            <label for="hist_no_atypical">If the fistula appears atypical or suspicious during surgery</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="histopathology_no_reason" value="For recurrent or complicated fistulas" id="hist_no_recurrent">
                            <label for="hist_no_recurrent">For recurrent or complicated fistulas</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="histopathology_no_reason" value="Routine practice regardless of suspicion" id="hist_no_routine">
                            <label for="hist_no_routine">Routine practice regardless of suspicion</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="histopathology_no_reason" value="Other" id="hist_no_other">
                            <label for="hist_no_other">Other (please specify)</label>
                        </div>
                    </div>
                    <input type="text" class="other-input" id="hist_no_other_text" placeholder="Please specify...">
                </div>

                <div class="form-group">
                    <label class="form-label">3.6. What is your suggested extent of fistula biopsy? <span class="required">*</span></label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="biopsy_extent" value="Full thickness Biopsy" id="biopsy_full" required>
                            <label for="biopsy_full">Full thickness Biopsy</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="biopsy_extent" value="Biopsy should include the surrounding tissue" id="biopsy_surrounding">
                            <label for="biopsy_surrounding">Biopsy should include the surrounding tissue</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="biopsy_extent" value="Internal opening only" id="biopsy_internal">
                            <label for="biopsy_internal">Internal opening only</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="biopsy_extent" value="External opening only" id="biopsy_external">
                            <label for="biopsy_external">External opening only</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="biopsy_extent" value="Both internal and external opening" id="biopsy_both">
                            <label for="biopsy_both">Both internal and external opening</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 4: Perceptions & Concerns -->
            <div class="survey-section">
                <h2 class="section-title">
                    <span class="form-section-number">4</span>
                    Perceptions & Concerns
                </h2>

                <div class="form-group">
                    <label class="form-label">4.1. Do you have any concerns regarding fistula tract cancer when you perform minimally invasive fistula procedures, such as FiLaC and VAAFT? (Check all that apply) <span class="required">*</span></label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" name="concerns_minimally_invasive" value="Concern about missing malignancy" id="concern_missing">
                            <label for="concern_missing">Yes, concern about missing a malignancy</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="concerns_minimally_invasive" value="Concern about causing or worsening cancer spread" id="concern_spread">
                            <label for="concern_spread">Yes, concern about causing or worsening cancer spread</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="concerns_minimally_invasive" value="Concern about inadequate diagnostic assessment pre-procedure" id="concern_assessment">
                            <label for="concern_assessment">Yes, concern about inadequate diagnostic assessment pre-procedure</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="concerns_minimally_invasive" value="Concern about delayed diagnosis due to conservative management" id="concern_delayed">
                            <label for="concern_delayed">Yes, concern about delayed diagnosis due to conservative management</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="concerns_minimally_invasive" value="No concerns" id="concern_none">
                            <label for="concern_none">No concerns</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="concerns_minimally_invasive" value="Other" id="concern_other">
                            <label for="concern_other">Other (please specify)</label>
                        </div>
                    </div>
                    <input type="text" class="other-input" id="concern_other_text" placeholder="Please specify...">
                </div>
            </div>

            <!-- Section 5: Risk Factors -->
            <div class="survey-section">
                <h2 class="section-title">
                    <span class="form-section-number">5</span>
                    Risk Factors
                </h2>

                <div class="form-group">
                    <label class="form-label">5.1. In your opinion, which of the following factors may increase the risk of developing fistula tract cancer? (Select all that apply) <span class="required">*</span></label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" name="risk_factors" value="Chronic fistula or long-standing fistulous disease (of about 10 years)" id="risk_chronic">
                            <label for="risk_chronic">Chronic fistula or long-standing fistulous disease (of about 10 years)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="risk_factors" value="Previous surgical interventions or treatments for the same fistula" id="risk_surgery">
                            <label for="risk_surgery">Previous surgical interventions or treatments for the same fistula</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="risk_factors" value="Presence of Crohn's disease or other inflammatory bowel diseases" id="risk_crohns">
                            <label for="risk_crohns">Presence of Crohn's disease or other inflammatory bowel diseases</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="risk_factors" value="Recurrent infections or abscesses in the anal region" id="risk_infections">
                            <label for="risk_infections">Recurrent infections or abscesses in the anal region</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="risk_factors" value="Smoking" id="risk_smoking">
                            <label for="risk_smoking">Smoking</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="risk_factors" value="Poorly controlled diabetes or other immunocompromising conditions" id="risk_immune">
                            <label for="risk_immune">Poorly controlled diabetes or other immunocompromising conditions</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="risk_factors" value="Lack of adequate follow-up or delayed diagnosis" id="risk_delayed">
                            <label for="risk_delayed">Lack of adequate follow-up or delayed diagnosis</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="risk_factors" value="Precancerous lesions in the anogenital region (HPV)" id="risk_hpv">
                            <label for="risk_hpv">Precancerous lesions in the anogenital region (HPV)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="risk_factors" value="Other" id="risk_other">
                            <label for="risk_other">Other (please specify)</label>
                        </div>
                    </div>
                    <input type="text" class="other-input" id="risk_other_text" placeholder="Please specify...">
                </div>
            </div>

            <!-- Section 6: Additional Insights -->
            <div class="survey-section">
                <h2 class="section-title">
                    <span class="form-section-number">6</span>
                    Additional Insights
                </h2>

                <div class="form-group">
                    <label class="form-label">6.1. Please share any insights or experiences related to fistula tract cancer.</label>
                    <textarea class="form-control textarea-large" name="additional_insights" id="additional_insights" placeholder="Please share your insights, experiences, or any additional comments..."></textarea>
                </div>
            </div>

            <!-- Section 7: Management Strategy -->
            <div class="survey-section">
                <h2 class="section-title">
                    <span class="form-section-number">7</span>
                    Management Strategy
                </h2>

                <div class="form-group">
                    <label class="form-label">7.1. All cases of fistula cancer should be discussed at the MDT <span class="required">*</span></label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="mdt_discussion" value="Agree" id="mdt_agree" required>
                            <label for="mdt_agree">Agree</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="mdt_discussion" value="Disagree" id="mdt_disagree">
                            <label for="mdt_disagree">Disagree</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">7.2. What would be your preferred treatment option for fistula tract cancer? <span class="required">*</span></label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="preferred_treatment" value="Chemo-Radiation Therapy" id="treatment_chemo" required>
                            <label for="treatment_chemo">Chemo-Radiation Therapy</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="preferred_treatment" value="Local resection" id="treatment_local">
                            <label for="treatment_local">Local resection</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="preferred_treatment" value="Neoadjuvant radiation and Chemotherapy with or without APR" id="treatment_neoadjuvant">
                            <label for="treatment_neoadjuvant">Neoadjuvant radiation and Chemotherapy with or without APR</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="preferred_treatment" value="Upfront APR" id="treatment_apr">
                            <label for="treatment_apr">Upfront APR</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="preferred_treatment" value="Palliation" id="treatment_pall">
                            <label for="treatment_pall">Palliation</label>
                        </div>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn-submit" id="submitBtn">
                <div class="loading-spinner" id="loadingSpinner"></div>
                Submit Survey
            </button>
        </form>

        <div class="success-message" id="successMessage">
            <h3>Thank you for your participation!</h3>
            <p>Your responses have been successfully submitted and will contribute to better understanding of fistula tract cancer.</p>
        </div>

        <div class="error-message" id="errorMessage">
            <h3>Submission Error</h3>
            <p id="errorText">There was an error submitting your survey. Please try again.</p>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE_URL = 'https://api.isolp.org/api/';
        const API_TOKEN = 'ISOLP654';
        
        // API Headers
        const headers = {
            'Authorization': `Bearer ${API_TOKEN}`,
            'Content-Type': 'application/json'
        };

        let totalSections = 7;
        let currentSection = 1;

        // Load countries from API
        async function loadCountries() {
            try {
                const response = await fetch(`${API_BASE_URL}getCountries`, {
                    method: 'GET',
                    headers: headers
                });
                const countries = await response.json();
                const countrySelect = document.getElementById('country');
                
                countries.forEach(country => {
                    const option = document.createElement('option');
                    option.value = country;
                    option.textContent = country;
                    countrySelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading countries:', error);
            }
        }

        // Initialize the survey
        document.addEventListener('DOMContentLoaded', function() {
            loadCountries();
            updateProgressBar();
            setupEventListeners();
        });

        function setupEventListeners() {
            // Radio button selection effects
            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    // Remove selected class from all items in the same group
                    document.querySelectorAll(`input[name="${this.name}"]`).forEach(r => {
                        r.closest('.radio-item').classList.remove('selected');
                    });
                    // Add selected class to current item
                    this.closest('.radio-item').classList.add('selected');
                    
                    // Handle conditional sections
                    if (this.name === 'routine_histopathology') {
                        handleHistopathologyConditional(this.value);
                    }
                });
            });

            // Checkbox selection effects
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        this.closest('.checkbox-item').classList.add('selected');
                    } else {
                        this.closest('.checkbox-item').classList.remove('selected');
                    }
                });
            });

            // Handle "Other" text inputs
            setupOtherInputs();

            // Form submission
            document.getElementById('fistulaTrackSurvey').addEventListener('submit', handleSubmit);

            // Progress tracking
            document.querySelectorAll('input, select, textarea').forEach(element => {
                element.addEventListener('change', updateProgressBar);
            });
        }

        function setupOtherInputs() {
            const otherInputs = [
                { radio: 'practice_other', text: 'practice_other_text' },
                { radio: 'spec_other', text: 'spec_other_text' },
                { checkbox: 'proc_other', text: 'proc_other_text' },
                { checkbox: 'diag_other', text: 'diag_other_text' },
                { checkbox: 'hist_yes_other', text: 'hist_yes_other_text' },
                { checkbox: 'hist_no_other', text: 'hist_no_other_text' },
                { checkbox: 'concern_other', text: 'concern_other_text' },
                { checkbox: 'risk_other', text: 'risk_other_text' }
            ];

            otherInputs.forEach(item => {
                const trigger = document.getElementById(item.radio || item.checkbox);
                const textInput = document.getElementById(item.text);
                
                if (trigger && textInput) {
                    trigger.addEventListener('change', function() {
                        if (this.checked) {
                            textInput.classList.add('show');
                        } else {
                            textInput.classList.remove('show');
                            textInput.value = '';
                        }
                    });
                }
            });
        }

        function handleHistopathologyConditional(value) {
            const yesGroup = document.getElementById('hist_yes_group');
            const noGroup = document.getElementById('hist_no_group');
            
            if (value === 'Yes') {
                yesGroup.style.display = 'block';
                noGroup.style.display = 'none';
            } else {
                yesGroup.style.display = 'none';
                noGroup.style.display = 'block';
            }
        }

        function updateProgressBar() {
            const form = document.getElementById('fistulaTrackSurvey');
            const formData = new FormData(form);
            const totalFields = form.querySelectorAll('input[required], select[required]').length;
            let filledFields = 0;
            
            form.querySelectorAll('input[required], select[required]').forEach(field => {
                if (field.type === 'radio' || field.type === 'checkbox') {
                    if (document.querySelector(`input[name="${field.name}"]:checked`)) {
                        filledFields++;
                    }
                } else if (field.value.trim() !== '') {
                    filledFields++;
                }
            });
            
            const progress = (filledFields / totalFields) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function collectFormData() {
            const formData = new FormData(document.getElementById('fistulaTrackSurvey'));
            const data = {};
            
            // Handle single-value fields
            const singleValueFields = [
                'age_group', 'sex', 'years_experience', 'country', 'practice_setting',
                'specialization', 'fistula_cases', 'is_islop_member', 'familiarity',
                'encountered_cases', 'opinion_commonality', 'confidence_in_diagnosis',
                'routine_histopathology', 'biopsy_extent', 'mdt_discussion', 
                'preferred_treatment', 'additional_insights'
            ];
            
            singleValueFields.forEach(field => {
                data[field] = formData.get(field) || '';
            });
            
            // Handle multi-value fields (checkboxes)
            const multiValueFields = [
                'procedures', 'diagnostics_used', 'histopathology_yes_reason',
                'histopathology_no_reason', 'concerns_minimally_invasive', 'risk_factors'
            ];
            
            multiValueFields.forEach(field => {
                data[field] = formData.getAll(field) || [];
            });
            
            // Handle "Other" text inputs for radio buttons
            const otherFields = [
                { field: 'practice_setting', otherValue: 'Other', textField: 'practice_other_text' },
                { field: 'specialization', otherValue: 'Other', textField: 'spec_other_text' }
            ];
            
            otherFields.forEach(item => {
                if (data[item.field] === item.otherValue) {
                    const otherText = document.getElementById(item.textField).value;
                    if (otherText) {
                        data[item.field] = otherText;
                    }
                }
            });
            
            // Handle checkbox "Other" fields
            const checkboxOtherFields = [
                { field: 'procedures', textField: 'proc_other_text' },
                { field: 'diagnostics_used', textField: 'diag_other_text' },
                { field: 'histopathology_yes_reason', textField: 'hist_yes_other_text' },
                { field: 'histopathology_no_reason', textField: 'hist_no_other_text' },
                { field: 'concerns_minimally_invasive', textField: 'concern_other_text' },
                { field: 'risk_factors', textField: 'risk_other_text' }
            ];
            
            checkboxOtherFields.forEach(item => {
                if (data[item.field] && data[item.field].includes('Other')) {
                    const otherText = document.getElementById(item.textField).value;
                    if (otherText) {
                        const index = data[item.field].indexOf('Other');
                        data[item.field][index] = otherText;
                    }
                }
            });
            
            // Convert boolean fields - now using "Yes"/"No" strings
            data.is_islop_member = data.is_islop_member === 'Yes';
            data.routine_histopathology = data.routine_histopathology === 'Yes';
            
            return data;
        }

        async function handleSubmit(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');
            
            // Show loading state
            submitBtn.disabled = true;
            loadingSpinner.style.display = 'inline-block';
            submitBtn.textContent = 'Submitting...';
            
            try {
                const formData = collectFormData();
                
                const response = await fetch(`${API_BASE_URL}submit-survey`, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    // Success
                    document.getElementById('fistulaTrackSurvey').style.display = 'none';
                    successMessage.style.display = 'block';
                    successMessage.scrollIntoView({ behavior: 'smooth' });
                } else {
                    throw new Error('Submission failed');
                }
            } catch (error) {
                console.error('Error submitting survey:', error);
                errorMessage.style.display = 'block';
                document.getElementById('errorText').textContent = 'There was an error submitting your survey. Please check your connection and try again.';
                errorMessage.scrollIntoView({ behavior: 'smooth' });
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                loadingSpinner.style.display = 'none';
                submitBtn.innerHTML = 'Submit Survey';
            }
        }
    </script>
</body>
</html>